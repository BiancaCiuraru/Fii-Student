<!DOCTYPE html>
<html lang="en">

<head>
	${require('./partials/shared/_head.html')}

	<title>FII Student - Panou principal</title>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
	<script>
		const title = 'Orar personalizat';
		const subtitle = 'Ce vei face astazi ?';
		const shouldBeLoggedIn = true;
	</script>
	<style>
		td {
			width: 15%;
		}
	</style>
</head>

<body>
	<div class="d-flex" id="wrapper">
		${require('./partials/shared/sidebar.html')}

		<div id="page-content-wrapper" class="bg-light">
			${require('./partials/shared/page-header.html')}
			<div class="container overflow-auto">
				<div class="section">
					<div class="content">
						<table class="table table-bordered schedule" id="tabel">
							<thead>
								<tr>
								<tr>
									<th scope="col"></th>
									<th scope="col" class="head-col">Luni</th>
									<th scope="col" class="head-col">Marți</th>
									<th scope="col" class="head-col">Miercuri</th>
									<th scope="col" class="head-col" id="joi">Joi</th>
									<th scope="col" class="head-col" id="vineri">Vineri</th>
									<th scope="col" class="head-col" id="sambata">Sâmbătă</th>
								</tr>
								</tr>
							</thead>
							<tbody>
								<tr id="h8">
									<th scope="row">8:00</th>
									<td class="Luni">
									</td>
									<td class="Marti"></td>
									<td class="Miercuri"></td>
									<td class="Joi"></td>
									<td class="Vineri"></td>
									<td class="Sambata"></td>
								</tr>
								<tr id="h10">
									<th scope="row">10:00</th>
									<td class="Luni"></td>
									<td class="Marti"></td>
									<td class="Miercuri"></td>
									<td class="Joi"></td>
									<td class="Vineri"></td>
									<td class="Sambata"></td>
								</tr>
								<tr id="h12">
									<th scope="row">12:00</th>
									<td class="Luni"></td>
									<td class="Marti"></td>
									<td class="Miercuri"></td>
									<td class="Joi"></td>
									<td class="Vineri"></td>
									<td class="Sambata"></td>
								</tr>
								<tr id="h14">
									<th scope="row">14:00</th>
									<td class="Luni"></td>
									<td class="Marti"></td>
									<td class="Miercuri"></td>
									<td class="Joi"></td>
									<td class="Vineri"></td>
									<td class="Sambata"></td>
								</tr>
								<tr id="h16">
									<th scope="row">16:00</th>
									<td class="Luni" id="td16"></td>
									<td class="Marti"></td>
									<td class="Miercuri"></td>
									<td class="Joi"></td>
									<td class="Vineri"></td>
									<td class="Sambata"></td>
								</tr>
								<tr id="h18">
									<th scope="row">18:00</th>
									<td class="Luni"></td>
									<td class="Marti"></td>
									<td class="Miercuri"></td>
									<td class="Joi"></td>
									<td class="Vineri"></td>
									<td class="Sambata"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-6 ">
						<button type="button" class="btn btn-primary float-right" href="javascript:void(0)" id="btnm"
							data-target="#addObj" data-toggle="modal">Adauga in orar</button></div>
					<div class="col-lg-6 text-left">
						<button type="button" class="btn btn-primary float-left" href="javascript:void(0)" id="save"
							>Salveaza</button></div>

				</div>
			</div>
		</div>
	</div>
	<div class="modal sign-modal fade scroll-modal" id="addObj" role="dialog">
		<div class="modal-dialog  modal-dialog-centered" style="width:600px;">
			<div class="modal-content">
				<div class="modal-body" style="justify-content: center">
					<div class="header">
						<h4 class="over-title">Adauga un obiect in orar</h4>

					</div>


					<div class="content">


						<form id="form1">

							

							<div class="form-group ">
								<label for="day">Ziua</label>
								<select name="day" id="day" class="form-control" required>
									<option value="" selected="selected">Alege o opțiune...</option>
									<option value="Luni">Luni</option>
									<option value="Marti">Marti</option>
									<option value="Miercuri">Miercuri</option>
									<option value="Joi">Joi</option>
									<option value="Vineri">Vineri</option>
									<option value="Sambata">Sambata</option>
								</select>
							</div>


							<div class="form-group ">
								<label for="starthour">Oră de start</label>
								<select name="starthour" id="starthour" class="form-control" required>
									<option value="" selected="selected">Alege o opțiune...</option>
									<option value="8">8</option>

									<option value="10">10</option>

									<option value="12">12</option>

									<option value="14">14</option>

									<option value="16">16</option>

									<option value="18">18</option>




								</select>

							</div>

							<div class="form-group ">
								<label for="finish">Oră de sfarsit</label>
								<select name="finish" id="finish" class="form-control" required>
									<option value="" selected="selected">Alege o opțiune...</option>
									<option value="8">8</option>
									
									<option value="10">10</option>
									
									<option value="12">12</option>
									
									<option value="14">14</option>
									
									<option value="16">16</option>
								
									<option value="18">18</option>
									
									<option value="20">20</option>


								</select>
							</div>
							<button type="submit" class="btn btn-primary float-right" href="javascript:void(0)" id="btn"
								data-toggle="modal" data-target="#addObj2">Cauta discipline</button>
							<button type="button" class=" btn btn-primary" data-toggle='modal'
								data-dismiss="modal">Renunta</button>

						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal sign-modal fade scroll-modal" id="addObj2" role="dialog">
		<div class="modal-dialog  modal-dialog-centered" style="width:600px;">
			<div class="modal-content">
				<div class="modal-body" style="justify-content: center">
					<div class="header">
						<h4 class="over-title">Adauga un obiect in orar</h4>

					</div>


					<div class="content">


						<form>
								<div class="form-group ">
								<label for="materie">Disciplina</label>
								<select name="materie" id="materie" class="form-control" required>
									<option value="" selected="selected">Alege o opțiune...</option>

								</select>
							</div>


							<div class="form-group ">
								<label for="tip">Tip activitate</label>
								<select name="tip" id="tip" class="form-control" required>
									<option value="" selected="selected">Alege o opțiune...</option>

								</select>

							</div>

							<button type="button" class="btn btn-primary align-center" id="add">Adauga</button>
							<button type="button" class=" btn btn-primary" data-toggle='modal'
								data-dismiss="modal">Renunta</button>

						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>




		var id;
		var zi;
		var start;
		var end;
		var rezultat;
		$('#form1').submit(function (event) {
			event.preventDefault();
			if (!this.checkValidity()) {
				return;
			}
			 zi = $('#day option:selected').val();
			 start = $('#starthour option:selected').val();
			 end = $('#finish option:selected').val();
		

			$('#materie').html('');
			$('#tip').html('');
			$.ajax({

				crossDomain: true,
				url: endpoint + 'courses_by_time',
				type: "GET",
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				beforeSend: function (xhr) {
					xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.getItem("accessToken"));
				},
				data: {
					weekday: zi,
					start_hour: start,
					end_hour: end
				},
				success: function (result) {
					rezultat=result;
					console.log(result);
					console.log(rezultat);
					for (let i = 0; i < result.length; i++) {
						$('#materie').append("<option id='" + result[i].id + "' value='" + result[i].title+" " +result[i].professor+" "+result[i].classroom+"'>" + result[i].title +" " + result[i].professor+" "+result[i].classroom+ '</option>');
						$('#tip').append('<option value="' + result[i].type + '">' + result[i].type + '</option>');

					}
				

					
				}})})
				$('#add').click(function () {
						let materie = $('#materie option:selected ').val();
						let tip = $('#tip option:selected').val();
						id = $('#materie option:selected').attr('id');
						let rezult=$('#materie option:selected classroom').val();
					   console.log(rezult)
						$.ajax({
							crossDomain: true,
							url: endpoint + 'custom_class',
							type: "PUT",
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							beforeSend: function (xhr) {
								xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.getItem("accessToken"));
							},
							data: JSON.stringify( {
								"schedule_class_id": id,
							
							}),
							
							success: function (result) {
								console.log(zi);
								
								switch (zi) {
									case 'Luni':
							

									
										for (h = 8; h <= 18; h += 2) {
											if (start === h.toString()) {

												$('#h' + h.toString() + " ." + 'Luni').append('<div class=\"object\" id=\"' + id+ start + zi+ "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + materie + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + tip.toLowerCase() + "\">" +tip + "</span>" +
				"</div>" +
				"</div>");
							
											}
											zi = undefined;
										}
										break;
									case 'Marti':
										for (h = 8; h <= 18; h += 2) {
											if (start === h.toString()) {
												$('#h' + h.toString() + " ." + 'Marti').append('<div class=\"object\" id=\"' + id+ start + zi+ "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + materie + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + tip.toLowerCase() + "\">" +tip + "</span>" +
				"</div>" +
				"</div>");
											}
											zi = undefined;
										}
										break;
									case 'Miercuri':
										for (h = 8; h <= 18; h += 2) {
											if (start === h.toString()) {
												$('#h' + h.toString() + " ." +'Miercuri' ).append('<div class=\"object\" id=\"' + id+ start + zi+ "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + materie + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + tip.toLowerCase() + "\">" +tip + "</span>" +
				"</div>" +
				"</div>");
											}
											zi = undefined;
										}
										break;
									case 'Joi':
										for (h = 8; h <= 18; h += 2) {
											if (start === h.toString()) {
												$('#h' + h.toString() + " ." + 'Joi').append('<div class=\"object\" id=\"' + id+ start + zi+ "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + materie + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + tip.toLowerCase() + "\">" +tip + "</span>" +
				"</div>" +
				"</div>");
											}
											zi = undefined;
										}
										break;
									case 'Vineri':
										for (h = 8; h <= 18; h += 2) {
											if (start === h.toString()) {
												$('#h' + h.toString() + " ." + 'Vineri').append('<div class=\"object\" id=\"' + id+ start + zi+ "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + materie + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + tip.toLowerCase() + "\">" +tip + "</span>" +
				"</div>" +
				"</div>");
											}
											zi = undefined;
										}
										break;
									case 'Sambata':
										for (h = 8; h <= 18; h += 2) {
											if (start === h.toString()) {
												$('#h' + h.toString() + " ." +'Sambata').append('<div class=\"object\" id=\"' + id+ start + zi+ "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + materie + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + tip.toLowerCase() + "\">" +tip + "</span>" +
				"</div>" +
				"</div>");}
											zi = undefined;
										}
										break;
								}
							}
						})
					})
				
					$('#save').click(function(){
					     load();
						
					})
					function getObjectHtml(object) {
			return "" +
				"<div class=\"object\" id=\"" + object.course_id + object.startTime + object.day + "\" data-toggle=\"modal\" data-target=\"#detailsModal\">" +
				"<p class=\"name\">" + object.name + "</p>" +
				"<p class=\"object-teacher\">" + object.professor + "</p>" +
				"<div class=\"badges\">" +
				"<span class=\"badge " + object.type.toLowerCase() + "\">" + object.type + "</span>" +
				"<span class=\"badge room\">" + object.classroom + "</p>" +
				"</div>" +
				"</div>";
		}
					$(document).ready(function load() { 
						$.ajax({

						crossDomain: true,
						url: endpoint + 'custom_schedule',
						type: "GET",
						contentType: "application/json; charset=utf-8",
						dataType: "json",
						beforeSend: function (xhr) {
						xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.getItem("accessToken"));
						},
						success: function(result){
							var objects = JSON.parse(result);
				   
					for (h = 8; h <= 18; h += 2) {
						objects.filter(x => x.startTime === h.toString()).forEach(element => {
							element.room = "C201";
							$('#h' + h.toString() + " ." + element.day).append(getObjectHtml(element));
							$('#'+ element.course_id+ element.startTime + element.day).on('click', function () {
    							resolveModal(element.course_id,element.professor,element.id);
								});
						});;
					}
				},
						
						})})

							
</script>

</body>

</html>